<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/tree/Node.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="FilesystemRepositoryManager.html">FilesystemRepositoryManager</a><ul class='methods'><li data-type='method'><a href="FilesystemRepositoryManager.html#.addRepository">addRepository</a></li><li data-type='method'><a href="FilesystemRepositoryManager.html#.createRepository">createRepository</a></li><li data-type='method'><a href="FilesystemRepositoryManager.html#.exists">exists</a></li><li data-type='method'><a href="FilesystemRepositoryManager.html#.get_sub_directories">get_sub_directories</a></li><li data-type='method'><a href="FilesystemRepositoryManager.html#.scan">scan</a></li><li data-type='method'><a href="FilesystemRepositoryManager.html#.scanAll">scanAll</a></li></ul></li><li><a href="GitRepositoryManager.html">GitRepositoryManager</a><ul class='methods'><li data-type='method'><a href="GitRepositoryManager.html#.addRepository">addRepository</a></li><li data-type='method'><a href="GitRepositoryManager.html#.checkoutBranch">checkoutBranch</a></li><li data-type='method'><a href="GitRepositoryManager.html#.createRepository">createRepository</a></li><li data-type='method'><a href="GitRepositoryManager.html#.exists">exists</a></li><li data-type='method'><a href="GitRepositoryManager.html#.get_sub_directories">get_sub_directories</a></li><li data-type='method'><a href="GitRepositoryManager.html#.getBranches">getBranches</a></li><li data-type='method'><a href="GitRepositoryManager.html#.getCurrentBranch">getCurrentBranch</a></li><li data-type='method'><a href="GitRepositoryManager.html#.isGitRepository">isGitRepository</a></li><li data-type='method'><a href="GitRepositoryManager.html#.mergeBranches">mergeBranches</a></li><li data-type='method'><a href="GitRepositoryManager.html#.mergeBranches">mergeBranches</a></li><li data-type='method'><a href="GitRepositoryManager.html#.scan">scan</a></li><li data-type='method'><a href="GitRepositoryManager.html#.scanAll">scanAll</a></li><li data-type='method'><a href="GitRepositoryManager.html#.update">update</a></li></ul></li><li><a href="MediaRepositoryManager.html">MediaRepositoryManager</a><ul class='methods'><li data-type='method'><a href="MediaRepositoryManager.html#.exists">exists</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.fetchCoreRepository">fetchCoreRepository</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.getRepositoriesNode">getRepositoriesNode</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.getRepositoryNames">getRepositoryNames</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.getRepositoryPath">getRepositoryPath</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.getType">getType</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.remove">remove</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.scanAll">scanAll</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.scanAll">scanAll</a></li><li data-type='method'><a href="MediaRepositoryManager.html#.update">update</a></li></ul></li><li><a href="module-connector-Connector.html">Connector</a><ul class='methods'><li data-type='method'><a href="module-connector-Connector.html#connect">connect</a></li><li data-type='method'><a href="module-connector-Connector.html#getDataType">getDataType</a></li><li data-type='method'><a href="module-connector-Connector.html#getId">getId</a></li><li data-type='method'><a href="module-connector-Connector.html#getPath">getPath</a></li><li data-type='method'><a href="module-connector-Connector.html#getProtoKey">getProtoKey</a></li></ul></li><li><a href="Node.html">Node</a><ul class='methods'><li data-type='method'><a href="Node.html#.addChild">addChild</a></li><li data-type='method'><a href="Node.html#.addNode">addNode</a></li><li data-type='method'><a href="Node.html#.firstChild">firstChild</a></li><li data-type='method'><a href="Node.html#.get">get</a></li><li data-type='method'><a href="Node.html#.getChild">getChild</a></li><li data-type='method'><a href="Node.html#.getChildNames">getChildNames</a></li><li data-type='method'><a href="Node.html#.getOrCreateNode">getOrCreateNode</a></li><li data-type='method'><a href="Node.html#.getParent">getParent</a></li><li data-type='method'><a href="Node.html#.getPath">getPath</a></li><li data-type='method'><a href="Node.html#.getRoot">getRoot</a></li><li data-type='method'><a href="Node.html#.hasChild">hasChild</a></li><li data-type='method'><a href="Node.html#.removeChild">removeChild</a></li><li data-type='method'><a href="Node.html#.set">set</a></li><li data-type='method'><a href="Node.html#.toString">toString</a></li></ul></li><li><a href="Root.html">Root</a><ul class='methods'><li data-type='method'><a href="Root.html#.createRecursive">createRecursive</a></li><li data-type='method'><a href="Root.html#.findNode">findNode</a></li><li data-type='method'><a href="Root.html#contains">contains</a></li></ul></li><li><a href="TextureManager.html">TextureManager</a><ul class='methods'><li data-type='method'><a href="TextureManager.html#scan">scan</a></li></ul></li><li><a href="TreeClient.html">TreeClient</a><ul class='methods'><li data-type='method'><a href="TreeClient.html#branchMediaRepository">branchMediaRepository</a></li><li data-type='method'><a href="TreeClient.html#callEndpoint">callEndpoint</a></li><li data-type='method'><a href="TreeClient.html#clientWindowFullscreen">clientWindowFullscreen</a></li><li data-type='method'><a href="TreeClient.html#clientWindowMaximize">clientWindowMaximize</a></li><li data-type='method'><a href="TreeClient.html#clientWindowMinimize">clientWindowMinimize</a></li><li data-type='method'><a href="TreeClient.html#clientWindowRestore">clientWindowRestore</a></li><li data-type='method'><a href="TreeClient.html#connectInstance">connectInstance</a></li><li data-type='method'><a href="TreeClient.html#createEndpoint">createEndpoint</a></li><li data-type='method'><a href="TreeClient.html#createInstance">createInstance</a></li><li data-type='method'><a href="TreeClient.html#createMediaRepository">createMediaRepository</a></li><li data-type='method'><a href="TreeClient.html#getAllInstances">getAllInstances</a></li><li data-type='method'><a href="TreeClient.html#getEndpointUrl">getEndpointUrl</a></li><li data-type='method'><a href="TreeClient.html#getInstance">getInstance</a></li><li data-type='method'><a href="TreeClient.html#readHJsonConfig">readHJsonConfig</a></li><li data-type='method'><a href="TreeClient.html#readTOMLConfig">readTOMLConfig</a></li><li data-type='method'><a href="TreeClient.html#removeInstance">removeInstance</a></li><li data-type='method'><a href="TreeClient.html#removeMediaRepository">removeMediaRepository</a></li><li data-type='method'><a href="TreeClient.html#scanMediaRepositories">scanMediaRepositories</a></li><li data-type='method'><a href="TreeClient.html#shutdownFlex">shutdownFlex</a></li><li data-type='method'><a href="TreeClient.html#startAllInstances">startAllInstances</a></li><li data-type='method'><a href="TreeClient.html#startInstance">startInstance</a></li><li data-type='method'><a href="TreeClient.html#stopAllInstances">stopAllInstances</a></li><li data-type='method'><a href="TreeClient.html#stopInstance">stopInstance</a></li><li data-type='method'><a href="TreeClient.html#synchronizeInstance">synchronizeInstance</a></li><li data-type='method'><a href="TreeClient.html#updateMediaRepository">updateMediaRepository</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="api%250AThe%2520RESTful%2520API%2520that%2520drives%2520flex.%250A%250ATODO_%2520swagger%2520documentation,%2520see%2520https___www.npmjs.com_package_swagger-jsdocmodule_.html">api
The RESTful API that drives flex.

TODO: swagger documentation, see https://www.npmjs.com/package/swagger-jsdoc</a></li><li><a href="context%250AProvides%2520an%2520application%2520context.module_.html">context
Provides an application context.</a></li><li><a href="media%250AProvides%2520media%2520management%2520functionalities.module_.html">media
Provides media management functionalities.</a></li><li><a href="module-connector.html">connector</a></li><li><a href="module-inexor-plugins_hjsonreader.html">inexor-plugins/hjsonreader</a></li><li><a href="module-inexor-plugins_tomlreader.html">inexor-plugins/tomlreader</a><ul class='methods'><li data-type='method'><a href="module-inexor-plugins_tomlreader.html#~isInMediaOrConfigDirectory">isInMediaOrConfigDirectory</a></li><li data-type='method'><a href="module-inexor-plugins_tomlreader.html#~readConfigFile">readConfigFile</a></li><li data-type='method'><a href="module-inexor-plugins_tomlreader.html#~withinDirectory">withinDirectory</a></li></ul></li><li><a href="module-manager.html">manager</a><ul class='methods'><li data-type='method'><a href="module-manager.html#~create">create</a></li><li data-type='method'><a href="module-manager.html#~start">start</a></li><li data-type='method'><a href="module-manager.html#~stop">stop</a></li></ul></li><li><a href="path%250A__%2520TODO_%2520Might%2520be%2520better%2520called%2520inexor-game_defaultsmodule_.html">path
// TODO: Might be better called inexor-game/defaults</a><ul class='methods'><li data-type='method'><a href="path%25250A__%252520TODO_%252520Might%252520be%252520better%252520called%252520inexor-game_defaultsmodule_.html#~getBasePath">getBasePath</a></li><li data-type='method'><a href="path%25250A__%252520TODO_%252520Might%252520be%252520better%252520called%252520inexor-game_defaultsmodule_.html#~getConfigPaths">getConfigPaths</a></li><li data-type='method'><a href="path%25250A__%252520TODO_%252520Might%252520be%252520better%252520called%252520inexor-game_defaultsmodule_.html#~getMediaPaths">getMediaPaths</a></li></ul></li><li><a href="tree%250AProvides%2520generic%2520methods%2520to%2520work%2520treesmodule_.html">tree
Provides generic methods to work trees</a></li><li><a href="treeclient%250AProvides%2520a%2520client%2520for%2520accessing%2520a%2520local%2520or%2520remote%2520Inexor%2520Tree%2520via%2520REST%2520API.module_.html">treeclient
Provides a client for accessing a local or remote Inexor Tree via REST API.</a></li><li><a href="types%250AConverts%2520Core%2520types%2520to%2520JavaScript%250ANOTE_%2520Requires%2520--harmony%2520flag%2520on%2520Node%2520_%25207.2.1module_.html">types
Converts Core types to JavaScript
NOTE: Requires --harmony flag on Node < 7.2.1</a><ul class='methods'><li data-type='method'><a href="types%25250AConverts%252520Core%252520types%252520to%252520JavaScript%25250ANOTE_%252520Requires%252520--harmony%252520flag%252520on%252520Node%252520_%2525207.2.1module_.html#~getDataType">getDataType</a></li><li data-type='method'><a href="types%25250AConverts%252520Core%252520types%252520to%252520JavaScript%25250ANOTE_%252520Requires%252520--harmony%252520flag%252520on%252520Node%252520_%2525207.2.1module_.html#~isInt">isInt</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#isValidDataType">isValidDataType</a></li><li><a href="global.html#media_types">media_types</a></li><li><a href="global.html#repository_types">repository_types</a></li><li><a href="global.html#separator">separator</a></li><li><a href="global.html#validName">validName</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">src/tree/Node.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const EventEmitter = require('events');
const util = require('./util')

/**
 * Represents a tree Node
 * @todo Add a verbose logging system (shouldn't be difficult though)
 */
class Node extends EventEmitter {
    /**
     * @constructor
     * @param {(Node|null)} - the parent node
     * @param {string} name - Must not contain whitespace or dots
     * @param {datatype} type - the data type to be used
     * @param {mixed} initValue
     * @param {boolean} sync
     * @param {boolean} readOnly
     */
    constructor(parent, name, datatype, initialValue = null, sync = false, readOnly = false) {
        // parent constructor
        super();

        /**
         * @private
         * @property {Node} parent
         */
        this._parent = parent;

        /**
         * @private
         * @property {string} _name
         */
        this._name = name;

        /**
         * @private
         * @property {string} _path
         */

        // The path of the tree (unique)
        if (parent != null) {
            if (parent._path != util.separator) {
                this._path = parent._path + util.separator + name;
            } else {
                this._path = util.separator + name;
            }
        } else {
            this._path = util.separator;
        }

        /**
         * @private
         * @property {datatype} _datatype
         */

        // The data type of the Node
        if (util.isValidDataType(datatype)) {
            this._datatype = datatype;
        } else {
            throw new Error('Invalid data type');
        }

        /**
         * @private
         * @property {boolean} _readOnly
         *
         * @todo this could be done using prototype defines
         */
        this._readOnly = readOnly;

        /**
         * Is a node a container (does it contain children)?
         * @property {boolean} isContainer
         */

        /**
         * Is the node a data leaf?
         * @property {boolean} isLeaf - is the node a data leaf?
         */

        /**
         * @private
         * @property {mixed} _value
         */

        /**
         * @private
         * @property {Date} _timespamp
         */

        /**
         * @private
         * @property {boolean} _sync
         */

        // Check the node type (either node or a data item)
        if (datatype == 'node') {
            this.isContainer = true;
            this.isLeaf = false;
            // Initializes the map of child nodes.

            this._value = new Map();
        } else {
            this.isContainer = false;
            this.isLeaf = true;

            // Sets the initial value.
            if (initialValue != null) {
                this._value = initialValue;
            } else {
                throw new Error('No initial value provided');
            }

            // Sets if the tree node should be synchronized.
            this._sync = sync;
        }
    }

    /**
     * Returns the path of the tree node.
     * @function
     * @name Node.getPath
     * @return {string}
     */
    getPath() {
        return this._path;
    }

    /**
     * Returns either the value or child nodes of the current node
     * @function
     * @name Node.get
     * @return {mixed|Node[]}
     */
    get() {
        return this._value;
    }

    /**
     * Set the value of the tree node
     * @function
     * @name Node.set
     * @param {mixed} value
     * @param {boolean} preventSync - whether the value should be synchronized or not
     * @fires Node.preSet
     * @fires Node.postSet
     * @fires Node.sync
     */
    set(value, preventSync = false) {
        if (this.isLeaf &amp;&amp; !this._readOnly) {
            let oldValue = this._value;
            this.emit('preSet', {oldValue: oldValue, newValue: value});
            // Update the value
            this._value = value;

            // Emit sync to be synchronized by the connector.
            if (this._sync &amp;&amp; !preventSync) {
                this.emit('sync', value);
            }

            // Set the timestamp when the value was last changed
            this._timestamp = Date.now();
            this.emit('postSet', {oldValue: oldValue, newValue: value});
        }
    }

    /**
     * Checks whether the node has specified child or not
     * @function
     * @name Node.hasChild
     * @param {string} name
     * @return {boolean}
     */
    hasChild(name) {
        return this.isContainer &amp;&amp; this._value.has(name);
    }

    /**
     * Checks wether the node has children
     * @name Node.hasChildren
     * @return {boolean}
     */
    hasChildren() {
      return !this.isContainer || !(this._value.size == 0);
    }

    /**
     * Returns the root node (from parent)
     * @function
     * @name Node.getRoot
     * @return {Root}
     */
    getRoot() {
        let root = this._parent;
        while (root._path != util.separator) {
            node = node._parent;
        }

        return root;
    }

    /**
     * Returns the child with the given name.
     * @function
     * @name Node.getChild
     * @param {string} name
     * @return {Node|null}
     */
    getChild(name) {
        if (this.hasChild(name)) {
        	  return this._value.get(name);
        } else {
        	  return null;
        }
    }

    /**
     * Returns the first child of the Node
     * @function
     * @name Node.firstChild
     * @return {Node|null}
     */
    firstChild() {
      return (this.hasChildren()) ? this.getChild(this.getChildNames()[0]) : [];
    }

    /**
     * Returns the child with the given name. If non-existent a node will be created.
     * @function
     * @name Node.getOrCreateNode
     * @param {string} name
     * @return {Node}
     */
    getOrCreateNode(name) {
        if (this.hasChild(name)) {
            return this.getChild(name);
        } else {
            return this.addNode(name);
        }
    }

    /**
     * Returns the child names
     * @function
     * @name Node.getChildNames
     * @return {Array&lt;string>}
     */
    getChildNames() {
        let keys = (this.hasChildren()) ? Array.from(this._value.keys()) : [];
        return keys;
    }

    /**
     * Adds a child to the node
     * @function
     * @name Node.addChild
     * @param {string} name
     * @param {tree.datatype} datatype
     * @param {mixed} initialValue
     * @param {boolean} sync
     * @param {boolean} readOnly
     * @return {Node}
     * @see Node.constructor
     * @fires Node.add
     */
    addChild(name, datatype, initialValue = null, sync = false, readOnly = false) {
        if (this.hasChild(name)) {
            return this.getChild(name);
        } else if (name.indexOf('/') == 0) {
            // This is NOT the root leave, don't insert it like this
            throw new Error('Child nodes shall not be prefixed with /');
        } else if (this.isContainer &amp;&amp; util.validName.test.bind(name) &amp;&amp; util.isValidDataType(datatype)) {
            // Create the child tree node
            let childNode = new Node(this, name, datatype, initialValue, sync, readOnly);
            // Add the child tree node to the children map
            this._value.set(name, childNode);

            let self = this;
            Object.defineProperty(self, name, {
                get() {
                    return (childNode.isContainer) ? childNode : childNode.get();
                },
                set(value) {
                    childNode.set(value);
                },
                configurable: true,
                writeable: !readOnly
            });

            this.emit('add', childNode); // Used for subscribing
            return childNode;
        } else {
        	  var reason = "";
        	  if (this.hasChild(name)) {
        	  	reason = "Child " + name + "already exists";
        	  } else if (!this.isContainer) {
        	  	reason = "Parent node must be a container node: isContainer=" + String(this.isContainter);
        	  } else if (!util.validName.test.bind(name)) {
        	  	reason = "Not a valid name:" + name;
        	  } else if (!util.isValidDataType(datatype)) {
        	  	reason = "Not a valid data type: " + datatype;
        	  }
            throw new Error('Failed to create child node: ' + reason);
        }
    }

    /**
     * @function
     * @property {string} name
     * @name Node.addNode
     * @alias Node.addChild
     */
    addNode(name) {
        return this.addChild(name, 'node');
    }

    /**
     * Removes a child by name
     * @function
     * @name Node.removeChild
     * @param {string} name
     */
    removeChild(name) {
        if (this.hasChild(name) &amp;&amp; !this.getChild(name)._readOnly) {
            this._value.delete(name);
            let self = this;
            delete self[name];
        }
    }

    /**
     * Returns the parent node or null if the tree node is the root node
     * @function
     * @name Node.getParent
     * @return {Node|null}
     */
    getParent() {
        return (this._path != util.separator) ? this._parent : null;
    }

    /**
     * Returns a JSON representation of the node
     * @function
     * @name Node.toString
     * @return {string}
     */
    toString() {
        if (this.isContainer) {
            let entries = {};
            for (var [name, childNode] of this._value.entries()) {
                entries[name] = childNode.toString();
            }
            return JSON.stringify(entries);
        } else {
            return JSON.stringify(this._value);
        }
    }

    /**
     * Iterates over the node and child nodes
     * @function
     * @return {Node}
     */
    [Symbol.iterator]() {
      let self = this; // Hacky slashy
      let position = 0;
      let childs = this.getChildNames();

      return {
        next: function() {
          // TODO: Lacks full iterative traversal yet
          if (position &lt; childs.length) {
            position++;
            return {value: self.getChild(childs[position - 1]), done: false};
          } else {
            return {done: true};
          }
        }
      }
    }
}

module.exports = Node;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Jan 19 2017 23:51:57 GMT+0100 (CET) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
